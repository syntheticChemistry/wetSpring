[package]
name = "wetspring-barracuda"
version = "0.1.0"
edition = "2021"
rust-version = "1.82"
authors = ["Squirrel Team"]
license = "AGPL-3.0-or-later"
description = "Life science + PFAS analytical chemistry pipelines — Rust + GPU via BarraCUDA/ToadStool"
repository = "https://github.com/syntheticChemistry/wetSpring"
keywords = ["bioinformatics", "mass-spectrometry", "pfas", "gpu", "wgsl"]
categories = ["science", "command-line-utilities"]

[workspace]

[features]
default = []
# GPU acceleration via BarraCUDA/ToadStool (Phase 3).
# Enable with `cargo build --features gpu`.
# Pulls in wgpu v22 (device creation), barracuda (11 ToadStool primitives),
# and tokio (async device init). 2 custom WGSL shaders (QF, DADA2 E-step)
# + 1 ToadStool shader (GEMM via GemmCached).
gpu = ["dep:barracuda", "dep:wgpu", "dep:tokio"]

[dependencies]
# serde_json: JSON parsing for validation data and model import.
serde_json = "1"

# BarraCUDA: shared scientific computing library (ToadStool GPU compute).
# Provides FusedMapReduceF64, BrayCurtisF64, BatchedEighGpu, GemmF64,
# KrigingF64, VarianceF64, CorrelationF64, CovarianceF64, WeightedDotF64.
barracuda = { path = "../../phase1/toadstool/crates/barracuda", optional = true }

# wgpu: WebGPU compute — hardware-agnostic GPU via Vulkan/Metal/DX12.
# Same version as barracuda to prevent duplicate symbol linking errors.
wgpu = { version = "22", optional = true }

# Async runtime for GPU device creation (barracuda already brings tokio in).
tokio = { version = "1", features = ["rt", "macros"], optional = true }


# bytemuck: zero-copy casting for GPU uniform buffers (GemmCached params).
# Already a transitive dep via barracuda; pinned here for local extensions.
bytemuck = { version = "1", features = ["derive"] }

# I/O: zlib decompression (mzML binary arrays) + GzDecoder (FASTQ .gz)
# XML parsing is sovereign (src/io/xml.rs); no quick-xml dependency.
flate2 = "1.0"

[dev-dependencies]
tempfile = "3"

# ── Track 1 validation binaries ──────────────────────────────────
[[bin]]
name = "validate_fastq"
path = "src/bin/validate_fastq.rs"

[[bin]]
name = "validate_diversity"
path = "src/bin/validate_diversity.rs"

# ── Track 2 validation binaries ──────────────────────────────────
[[bin]]
name = "validate_mzml"
path = "src/bin/validate_mzml.rs"

[[bin]]
name = "validate_pfas"
path = "src/bin/validate_pfas.rs"

# ── Feature pipeline validation binary (Exp009) ──────────────────
[[bin]]
name = "validate_features"
path = "src/bin/validate_features.rs"

# ── Peak detection validation binary (Exp010) ────────────────────
[[bin]]
name = "validate_peaks"
path = "src/bin/validate_peaks.rs"

# ── 16S pipeline validation binary (dada2/chimera/taxonomy/unifrac) ──
[[bin]]
name = "validate_16s_pipeline"
path = "src/bin/validate_16s_pipeline.rs"

# ── Algae pond 16S validation binary (Exp012, paper proxy) ───────
[[bin]]
name = "validate_algae_16s"
path = "src/bin/validate_algae_16s.rs"

# ── Extended algae validation binary (Exp017, PRJNA382322) ───────
[[bin]]
name = "validate_extended_algae"
path = "src/bin/validate_extended_algae.rs"

# ── VOC peak validation binary (Exp013, Reese 2019) ─────────────
[[bin]]
name = "validate_voc_peaks"
path = "src/bin/validate_voc_peaks.rs"

# ── Public data benchmark validation (Exp014, PRJNA1114688) ──────
[[bin]]
name = "validate_public_benchmarks"
path = "src/bin/validate_public_benchmarks.rs"

# ── PFAS library validation binary (Exp018, Jones Lab) ───────────
[[bin]]
name = "validate_pfas_library"
path = "src/bin/validate_pfas_library.rs"

# ── Robinson-Foulds tree distance validation (Exp021) ───────────
[[bin]]
name = "validate_rf_distance"
path = "src/bin/validate_rf_distance.rs"

# ── QS/c-di-GMP ODE validation (Exp020, Waters 2008) ────────────
[[bin]]
name = "validate_qs_ode"
path = "src/bin/validate_qs_ode.rs"

# ── Gillespie SSA validation (Exp022, Massie 2012) ────────────────
[[bin]]
name = "validate_gillespie"
path = "src/bin/validate_gillespie.rs"

# ── Newick parsing validation (Exp019 Phase 1) ────────────────────
[[bin]]
name = "validate_newick_parse"
path = "src/bin/validate_newick_parse.rs"

# ── PFAS decision tree inference (Exp008 Phase 3) ─────────────────
[[bin]]
name = "validate_pfas_decision_tree"
path = "src/bin/validate_pfas_decision_tree.rs"

# ── Pipeline benchmark (Exp015: Rust CPU vs Galaxy/QIIME2) ───────
[[bin]]
name = "benchmark_pipeline"
path = "src/bin/benchmark_pipeline.rs"

# ── GPU validation binaries (require --features gpu) ─────────────
[[bin]]
name = "validate_diversity_gpu"
path = "src/bin/validate_diversity_gpu.rs"
required-features = ["gpu"]

# ── GPU 16S pipeline parity (Exp016: CPU vs GPU math parity) ─────
[[bin]]
name = "validate_16s_pipeline_gpu"
path = "src/bin/validate_16s_pipeline_gpu.rs"
required-features = ["gpu"]

# ── CPU vs GPU benchmark (require --features gpu) ────────────────
[[bin]]
name = "benchmark_cpu_gpu"
path = "src/bin/benchmark_cpu_gpu.rs"
required-features = ["gpu"]
